<nav class="menu" [class.collapsed]="isCollapsed" [class.mobile-open]="menuAbierto">
  <div class="menu-overlay" [class.active]="menuAbierto" (click)="cerrarMenu()"></div>

  <div class="menu-header">
    <button class="collapse-toggle" type="button" (click)="toggleCollapsed()" aria-label="Alternar ancho del menÃº">
      <span class="collapse-icon" [class.collapsed]="isCollapsed"></span>
    </button>

    <a class="home-button" routerLink="/principal" (click)="cerrarMenu()" title="Ir al panel principal">
      <span class="home-icon">ğŸ </span>
      <span class="home-label" *ngIf="!isCollapsed">Principal</span>
    </a>

    <button class="menu-toggle" (click)="toggleMenu()" [class.active]="menuAbierto" type="button" aria-label="Abrir menÃº en mÃ³vil">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <div class="menu-body" [class.active]="menuAbierto">
    <ng-container *ngTemplateOutlet="renderItems; context: { items: menuTree, level: 1 }"></ng-container>
  </div>
</nav>

<ng-template #renderItems let-items let-level="level">
  <ul class="menu-level menu-level-{{ level }}" [class.collapsed]="isCollapsed">
    <li *ngFor="let item of items">
      <div
        class="menu-entry level-{{ level }}"
        [class.has-children]="item.children?.length"
        [class.expanded]="isExpanded(item)"
        [class.active]="isActive(item)"
        (click)="onItemClick(item, $event)">

        <button
          *ngIf="item.children?.length"
          class="expander"
          type="button"
          aria-label="Expandir o contraer"
          (click)="toggleItem(item, $event)">
          {{ isExpanded(item) ? 'âˆ’' : '+' }}
        </button>

        <span class="item-icon">{{ item.icon }}</span>
        <span class="item-label" *ngIf="!isCollapsed">{{ item.label }}</span>
      </div>

      <ng-container *ngIf="item.children?.length && isExpanded(item)">
        <ng-container *ngTemplateOutlet="renderItems; context: { items: item.children, level: level + 1 }"></ng-container>
      </ng-container>
    </li>
  </ul>
</ng-template>
